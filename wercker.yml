box: wercker/php
services:
    - wercker/mysql
build:
    steps:
        - desmondmorris/drush
        - script: # This will change once we have the build make file ready
            name: Drush make
            code: |-
                drush make drupal-org-core.make build
        - script: # The standard profile will change to dosomething when ready
            name: Install Drupal
            code: |-
                cd $WERCKER_SOURCE_DIR/build
                drush site-install standard --db-url=$WERCKER_MYSQL_URL -y
        - script:
            name: Enable simpletest
            code: |-
                cd $WERCKER_SOURCE_DIR/build
                drush en simpletest -y
                drush vset --yes simpletest_verbose FALSE
        - script: # There has to be a patch for the sleep hack
           name: Start server
           code: |-
                cd $WERCKER_SOURCE_DIR/build
                drush runserver --server=builtin 8080 & sleep 4
        - script: # We will change this to our TestSuite
           name: Run tests
           code: |-
                cd $WERCKER_SOURCE_DIR/build
                drush test-run DrupalGotoTest --xml --uri=http://127.0.0.1:8080
